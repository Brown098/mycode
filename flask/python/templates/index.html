<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask前端页面</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>

<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">
            <i class="fa fa-code text-blue-500 mr-2"></i>Flask前后端示例
        </h1>

        <!-- 1. 展示从后端模板变量传递的数据 -->
        <div class="mb-8 border-b pb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">模板变量数据</h2>
            <ul class="space-y-3">
                <li class="flex items-center">
                    <span class="w-24 text-gray-500">用户名：</span>
                    <span class="font-medium">{{ user }}</span> <!-- 直接使用模板变量 -->
                </li>
                <li class="flex items-center">
                    <span class="w-24 text-gray-500">分数：</span>
                    <span class="font-medium">{{ user_score }}</span>
                </li>
                <li class="flex items-center">
                    <span class="w-24 text-gray-500">会员状态：</span>
                    <span class="font-medium">{{ '是' if member_status else '否' }}</span>
                </li>
                <li class="flex flex-col">
                    <span class="text-gray-500 mb-1">爱好：</span>
                    <ul class="list-disc list-inside ml-24">
                        {% for hobby in user_hobbies %} <!-- 模板循环语法 -->
                        <li>{{ hobby }}</li>
                        {% endfor %}
                    </ul>
                </li>
                <li class="flex flex-col">
                    <span class="text-gray-500 mb-1">用户详情：</span>
                    <div class="ml-24">
                        <p>姓名：{{ user_detail.name }}</p>
                        <p>年龄：{{ user_detail.age }}</p>
                        <p>城市：{{ user_detail.city }}</p>
                    </div>
                </li>
            </ul>
        </div>

        <!-- 2. 展示从/api接口获取的JSON数据 -->

        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>接收JSON数据示例</title>
            <!-- 引入Tailwind CSS -->
            <script src="https://cdn.tailwindcss.com"></script>
            <!-- 引入Font Awesome -->
            <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

            <!-- 配置Tailwind自定义颜色 -->
            <script>
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#3B82F6',
                                secondary: '#10B981',
                                neutral: '#64748B',
                            },
                            fontFamily: {
                                sans: ['Inter', 'system-ui', 'sans-serif'],
                            },
                        }
                    }
                }
            </script>

            <!-- 自定义工具类 -->
            <style type="text/tailwindcss">
                @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
        </head>

        <body class="bg-gray-50 font-sans">
            <div class="container mx-auto px-4 py-8 max-w-4xl">
                <header class="mb-8 text-center">
                    <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-2">
                        <i class="fa fa-exchange text-primary mr-2"></i>Flask JSON数据接收示例
                    </h1>
                    <p class="text-neutral text-lg">从后端API获取并展示JSON数据</p>
                </header>

                <main>
                    <!-- 数据展示卡片 -->
                    <div class="bg-white rounded-xl p-6 card-shadow transition-all duration-300 hover:shadow-lg mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">用户信息</h2>
                            <button id="refreshBtn"
                                class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-refresh mr-2"></i>刷新数据
                            </button>
                        </div>

                        <!-- 加载状态 -->
                        <div id="loading" class="text-center py-10 hidden">
                            <i class="fa fa-circle-o-notch fa-spin text-3xl text-primary mb-3"></i>
                            <p class="text-neutral">正在加载数据...</p>
                        </div>

                        <!-- 错误状态 -->
                        <div id="error" class="text-center py-10 hidden">
                            <i class="fa fa-exclamation-triangle text-yellow-500 text-3xl mb-3"></i>
                            <p class="text-red-500" id="errorMessage">加载数据失败</p>
                        </div>

                        <!-- 数据展示区域 -->
                        <div id="dataContainer" class="space-y-4 opacity-0 transition-opacity duration-500">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-4 border border-gray-100 rounded-lg bg-gray-50">
                                    <p class="text-neutral text-sm mb-1">用户名</p>
                                    <p id="username" class="font-medium text-gray-800">-</p>
                                </div>
                                <div class="p-4 border border-gray-100 rounded-lg bg-gray-50">
                                    <p class="text-neutral text-sm mb-1">分数</p>
                                    <p id="score" class="font-medium text-gray-800">-</p>
                                </div>
                                <div class="p-4 border border-gray-100 rounded-lg bg-gray-50 md:col-span-2">
                                    <p class="text-neutral text-sm mb-1">是否为数字用户</p>
                                    <p id="isNumber" class="font-medium text-gray-800">-</p>
                                </div>
                            </div>

                            <!-- 原始JSON数据展示 -->
                            <div class="mt-6">
                                <p class="text-neutral text-sm mb-2">原始JSON数据：</p>
                                <pre id="rawJson"
                                    class="bg-gray-800 text-gray-100 p-4 rounded-lg text-sm overflow-x-auto"></pre>
                            </div>
                        </div>
                    </div>

                    <!-- 说明卡片 -->
                    <div class="bg-blue-50 border border-blue-100 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center">
                            <i class="fa fa-info-circle mr-2"></i>工作原理
                        </h3>
                        <ul class="list-disc list-inside text-blue-700 space-y-2 text-sm">
                            <li>页面加载时自动从Flask后端API获取数据</li>
                            <li>使用JavaScript的fetch API发送请求到后端的/api路由</li>
                            <li>接收到JSON数据后，解析并展示在页面上</li>
                            <li>点击"刷新数据"按钮可以重新获取最新数据</li>
                        </ul>
                    </div>
                </main>

                <footer class="mt-12 text-center text-neutral text-sm">
                    <p>© 2023 Flask JSON数据接收示例</p>
                </footer>
            </div>

            <script>
                // 后端API地址
                const API_URL = '/api';

                // DOM元素
                const loading = document.getElementById('loading');
                const error = document.getElementById('error');
                const errorMessage = document.getElementById('errorMessage');
                const dataContainer = document.getElementById('dataContainer');
                const usernameEl = document.getElementById('username');
                const scoreEl = document.getElementById('score');
                const isNumberEl = document.getElementById('isNumber');
                const rawJsonEl = document.getElementById('rawJson');
                const refreshBtn = document.getElementById('refreshBtn');

                // 页面加载时获取数据
                document.addEventListener('DOMContentLoaded', () => {
                    fetchData();

                    // 绑定刷新按钮事件
                    refreshBtn.addEventListener('click', fetchData);
                });

                // 获取数据函数
                async function fetchData() {
                    // 显示加载状态
                    showLoading();

                    try {
                        // 发送请求到后端API
                        const response = await fetch(API_URL);

                        // 检查响应是否成功
                        if (!response.ok) {
                            throw new Error(`HTTP错误，状态码: ${response.status}`);
                        }

                        // 解析JSON数据
                        const data = await response.json();

                        // 展示数据
                        displayData(data);

                    } catch (err) {
                        // 显示错误信息
                        showError(err.message);
                        console.error('获取数据失败:', err);
                    }
                }

                // 展示数据
                function displayData(data) {
                    // 隐藏加载和错误状态
                    hideAllStatus();

                    // 填充数据到页面
                    usernameEl.textContent = data.username || '未知';
                    scoreEl.textContent = data.score !== undefined ? data.score : '未知';
                    isNumberEl.textContent = data.is_number ? '是' : '否';

                    // 显示原始JSON数据（格式化后）
                    rawJsonEl.textContent = JSON.stringify(data, null, 2);

                    // 显示数据容器（带动画）
                    dataContainer.classList.remove('opacity-0');
                }

                // 显示加载状态
                function showLoading() {
                    loading.classList.remove('hidden');
                    error.classList.add('hidden');
                    dataContainer.classList.add('opacity-0');
                }

                // 显示错误状态
                function showError(message) {
                    loading.classList.add('hidden');
                    error.classList.remove('hidden');
                    dataContainer.classList.add('opacity-0');
                    errorMessage.textContent = `加载数据失败: ${message}`;
                }

                // 隐藏所有状态
                function hideAllStatus() {
                    loading.classList.add('hidden');
                    error.classList.add('hidden');
                }
            </script>
        </body>

</html>